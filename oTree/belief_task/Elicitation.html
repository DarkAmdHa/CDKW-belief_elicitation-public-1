{% extends "global/Page.html" %}
{% load otree %}
{{ block title }}{% if session.config.prolific %}Round {{ player.round_number }}{% else %}Part A (Round {{ player.round_number }}){% endif %}{{ endblock }}

{{ block scripts }}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
var slider = document.getElementById("myRange1");
var output2 = document.getElementById("demo2");
var output1 = document.getElementById("demo1");
<!--output2.innerHTML = slider.value;-->
<!--output1.innerHTML = slider.value;-->

slider.oninput = function() {
  output2.innerHTML = this.value;
  output1.innerHTML = 100-this.value;
  active1.style.display = "block";
  inactive1.style.display = "none";
}
</script>
<script>
var slider = document.getElementById("myRange2");
var minvalue = document.getElementById("min");
var maxvalue = document.getElementById("max");
var beliefvalue = {{ player.belief }};

slider.oninput = function() {
  minvalue.innerHTML = beliefvalue-(100-this.value);
  maxvalue.innerHTML = beliefvalue+(100-this.value);
  if (minvalue.innerHTML<0) {
    minvalue.innerHTML=0;
  }
  if (maxvalue.innerHTML>100) {
    maxvalue.innerHTML=100;
  }
  if (this.value==100) {
    certain2.style.display = "block";
    uncertain2.style.display = "none";
  }
  if (this.value!=100) {
    certain2.style.display = "none";
    uncertain2.style.display = "block";
  }
  instruction2.style.display = "none";
  active2.style.display = "block";
  inactive2.style.display = "none";
}
</script>
<script type="text/javascript">
//Array containing possible colors,and the number of balls already colored with that given color
let allColors;
{% if treatrisk %}
    {% if prior == 50 %}
        allColors = [
            {
                color: '{{ slicecolor1 }}',
                number: 0
            },
            {
                color: '{{ slicecolor2 }}',
                number: 0
            }
        ];
    {% else %}
        allColors = [
            {
                color: '{{ slicecolor1 }}',
                number: 0
            },
            {
                color: '{{ slicecolor2 }}',
                number: 0
            },
            {
                color: '{{ slicecolor3 }}',
                number: 0
            },
            {
                color: '{{ slicecolor4 }}',
                number: 0
            },
            {
                color: '{{ slicecolor5 }}',
                number: 0
            },
        ];
    {% endif %}
{% else %}
    allColors =  [];
{% endif %}
</script>
<script>
const urnContainer = document.querySelector('.urn');
const totalNumOfBalls = {{ session.config.numballs }}
//Ball Object
  class Ball {

    constructor(x, y, color,colorName, border, size) {
       this.x = x;
       this.y = y;
       this.color = color;
       this.colorName = colorName;
       this.border = border;
    }
    //Function to "draw" the ball using the details it's object has
    draw() {
        const ball = document.createElement('div');
        ball.classList.add('ball');
        ball.style.left = this.x + 'px';
        ball.style.top = this.y + 'px';
        if(this.border){
            ball.classList.add('uncolored');
        }else{
            ball.classList.add(this.colorName);
            ball.style.background = this.color;
        }
        urnContainer.appendChild(ball);
      }
 }

 //A sort of flag to know that the balls are already highlighted, in order to prevent multiple calls to the highlighting function
 let ballsHighlighted = false;
 const highlightBalls = function(isColor, colorName) {
     //If already highlighted, break out
     if(ballsHighlighted){
        return;
     }
     ballsHighlighted = true;

    let ballsToHighlight,
        rowToHighlight,
    className;

    //Highlight the balls with the specified color
    if(isColor){
        ballsToHighlight = urnContainer.querySelectorAll(`.ball.${colorName}`);
        rowToHighlight = urnContainer.querySelector(`.color-row.${colorName}`);
        className = 'highlighted'

        rowToHighlight.classList.toggle(`${className}`);
    //Highlight the balls that are NOT of the specified color
    }else{
        ballsToHighlight = urnContainer.querySelectorAll(`.ball:not(.${colorName})`);
        rowToHighlight = urnContainer.querySelectorAll(`.color-row:not(.${colorName})`);
        className = 'highlightedAll';
        for (var i =0;i<rowToHighlight.length; i++){
            rowToHighlight[i].classList.toggle(`${className}`);
        }
    }

    for (var i =0;i<ballsToHighlight.length; i++){
        ballsToHighlight[i].classList.toggle(`${className}`);
    }
 }

 const unhighlightBalls = (isColor, colorName)=>{
      if(!ballsHighlighted){
        return;
     }

     let ballsToHighlight,
         rowToHighlight,
        className;

    //Highlight the balls with the specified color
    if(isColor){
        ballsToHighlight = urnContainer.querySelectorAll(`.ball.${colorName}`);
        rowToHighlight = urnContainer.querySelector(`.color-row.${colorName}`);
        className = 'highlighted'

        rowToHighlight.classList.toggle(`${className}`);

    //Highlight the balls that are NOT of the specified color
    }else{
        ballsToHighlight = urnContainer.querySelectorAll(`.ball:not(.${colorName})`);
        rowToHighlight = urnContainer.querySelectorAll(`.color-row:not(.${colorName})`);
        className = 'highlightedAll';
        for (var i =0;i<rowToHighlight.length; i++){
            rowToHighlight[i].classList.toggle(`${className}`);
        }
    }

    for (var i=0;i<ballsToHighlight.length; i++){
        ballsToHighlight[i].classList.toggle(`${className}`);
    }
    ballsHighlighted = false;
}

 //Balls array, used to later draw each ball object within
balls = [];

if(totalNumOfBalls == 100){
    let size = 20,
        yPos = 0,
        i=0,
        x=17,
        y=278,
        increment = 5;
        while(balls.length<totalNumOfBalls){
    //First row of balls is unique, in order to account for the curved section of the jar
    if(yPos === 0){
        ball = new Ball(
        x,
        y,
        '#333',
        'red',
        true
    );
    x+=size+2;
    //If reached the end of the first row(right side of the jar), go to the next row
    if(x>220){
        yPos += 1;
    }
    balls.push(ball);
}
//All other rows
else if(yPos >= 1){
    if(x>=220){
        yPos +=1;
        y-=size+2;
        x=0;
    }else{
        x+=size+increment;
    }
    ball = new Ball(
        x,
        y,
        '#333',
        'red',
        true
    );
    balls.push(ball);

    }

}
}else{
    document.querySelector('.urn').classList.add('urn-10')
    let size = 45,
        yPos = 0,
        i=0,
        x=10,
        y=210,
        increment = 5;


    while(balls.length<totalNumOfBalls){
    //First row of balls is unique, in order to account for the curved section of the jar
    if(yPos === 0){
        ball = new Ball(
        x,
        y,
        '#333',
        'red',
        true
    );
    x+=size+2;
    //If reached the end of the first row(right side of the jar), go to the next row
    if(x>80){
        yPos += 1;
    }
    balls.push(ball);
}
//All other rows
else if(yPos >= 1){
    if(x>=50){
        yPos +=1;
        y-=size+2;
        x=10;
    }else{
        x+=size+increment;
    }
    ball = new Ball(
        x,
        y,
        '#333',
        'red',
        true
    );
    balls.push(ball);

    }

}
}




//Loop through each ball object in the 'balls' array, in order to "draw" each of them
function loop() {
    for (const ball of balls) {
      ball.draw();
    }
}

//Call to drawing functions
loop();

const allBalls = document.querySelectorAll('.ball'),
numberOfColors = allColors.length;


//Function used in order to get a random color from the array, making sure that the number of balls of the returned color has not already surpassed
// the possible maximum
const getRandomColor = function(){
    let colorToAdd = allColors[Math.floor(Math.random() * numberOfColors)];
    while(colorToAdd.number>=(100/numberOfColors)){
        colorToAdd = allColors[Math.floor(Math.random() * numberOfColors)];
    }
    colorToAdd.number = `${parseInt(colorToAdd.number)+1}`;
    return colorToAdd;
}

//Function used to get consecutive colors, in case on wants to fill each row with the same color
//The colors of each row are still randomized
// let colorIndex =Math.floor(Math.random() * numberOfColors),
//     colorToAdd = allColors[colorIndex];
// const getConsecutiveColors = function(){
//     if(colorToAdd.number>=100/numberOfColors){
//         colorIndex = Math.floor(Math.random() * numberOfColors);
//         colorToAdd = allColors[colorIndex];
//         while(colorToAdd.number>=(100/numberOfColors)){
//             colorIndex = Math.floor(Math.random() * numberOfColors)
//             colorToAdd = allColors[colorIndex];
//         }
//     }
//     colorToAdd.number = `${parseInt(colorToAdd.number)+1}`;
//     return colorToAdd;
// }

let colorIndex = 0,
    colorToAdd = allColors[colorIndex];
const getConsecutiveColors = function(){
    if(colorToAdd.number>=totalNumOfBalls/numberOfColors){
        colorIndex++;
        colorToAdd = allColors[colorIndex];
        while(colorToAdd.number>=(totalNumOfBalls/numberOfColors)){
            colorIndex = Math.floor(Math.random() * numberOfColors)
            colorToAdd = allColors[colorIndex];
        }
    }
    colorToAdd.number = `${parseInt(colorToAdd.number)+1}`;
    return colorToAdd;
}
</script>
<script>
if(allColors.length>0){
    allBalls.forEach(ball =>{
        ball.classList.remove('uncolored');
        //If you want random colors, use the following line of code
        // let colorToAdd = getRandomColor();
        //Else:
        let colorToAdd = getConsecutiveColors();
        let colorName = colorToAdd.color;
        ball.style.background = colorName.replace(/\s/g, "").toLowerCase();
        ball.classList.add(colorName.replace(/\s/g, "-").toLowerCase());
    })
    //Set left column rows positions
    let leftColumnRows = document.querySelectorAll('.color-row'),
        colorBefore ='blank',
        totalRows,
        indexToShowText;
    if(totalNumOfBalls === 100){
        totalRows = 10;
        indexToShowText = 10;
    }
    else if(totalNumOfBalls === 10){
        totalRows = 5;
        indexToShowText = 2;
    }


    for(let i = totalRows - 1;i>=0;i--){
        console.log(i * indexToShowText);
        leftColumnRows[i].style.top = `${allBalls[i*indexToShowText].offsetTop - 3}px`;
        if(allBalls[i*indexToShowText].style.background != '' && colorBefore != allBalls[i*indexToShowText].style.background){
            leftColumnRows[i].innerText = `${document.querySelectorAll('.' + allBalls[i*indexToShowText].style.background).length} ${allBalls[i*indexToShowText].style.background} balls`;
            leftColumnRows[i].classList.add(`${allBalls[i*indexToShowText].style.background}`)
            colorBefore = allBalls[i*indexToShowText].style.background;
        }
    }
}
const predictedEvent = '{{colorevent}}';
{% if treatrisk %}
    {% if predictfalse %}
        setTimeout(()=>{
            highlightBalls(false, predictedEvent.replace(/\s/g, "-").toLowerCase());
            //Unhighlight after 2seconds
            setTimeout(()=>{
                unhighlightBalls(false, predictedEvent.replace(/\s/g, "-").toLowerCase())
            },2000);

            document.querySelector('.predicted-event').addEventListener('mouseenter', ()=>{
                highlightBalls(false, predictedEvent.replace(/\s/g, "-").toLowerCase());
            });
            document.querySelector('.predicted-event').addEventListener('mouseleave', ()=>{
                unhighlightBalls(false, predictedEvent.replace(/\s/g, "-").toLowerCase());
            });
        },1000);
    {% else %}
        setTimeout(()=>{
            highlightBalls(true, predictedEvent.replace(/\s/g, "-").toLowerCase());
            //Unhighlight after 2seconds
            setTimeout(()=>{
                unhighlightBalls(true, predictedEvent.replace(/\s/g, "-").toLowerCase())
            },2000);

            document.querySelector('.predicted-event').addEventListener('mouseenter', ()=>{
                highlightBalls(true, predictedEvent.replace(/\s/g, "-").toLowerCase());
            });
            document.querySelector('.predicted-event').addEventListener('mouseleave', ()=>{
                unhighlightBalls(true, predictedEvent.replace(/\s/g, "-").toLowerCase());
            });
        },1000);
    {% endif %}
{% endif %}
</script>
<script>
const sliders = document.querySelectorAll('.slider');
for(let i = 0;i<sliders.length;i++){
    sliders[i].addEventListener('mousedown', ()=>{
        sliders[i].classList.remove('slider-thumb-hidden');
    });
}
</script>
<!-- Codes for math typesetting -->
<script>
MathJax = {
    tex: {inlineMath: [['$', '$'], ['\\(', '\\)']]},
    startup: {
        ready: function () {
            MathJax.startup.defaultReady();
            document.getElementById('render').disabled = false;
        }
    }
}
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
function convert() {
    var input = document.getElementById("input").value.trim();
    var button = document.getElementById("render");
    button.disabled = true;
    output = document.getElementById('output');
    output.innerHTML = input;
    MathJax.texReset();
    MathJax.typesetClear();
    MathJax.typesetPromise()
    .catch(function (err) {
        output.innerHTML = '';
        output.appendChild(document.createElement('pre')).appendChild(document.createTextNode(err.message));
    })
    .then(function() {
        button.disabled = false;
    });
}
</script>
<!-- Overlay toggle -->
<script>
// Get the videos
var video1 = document.getElementById("myVideo1");
var video2 = document.getElementById("myVideo2");
var video3 = document.getElementById("myVideo3");

// Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
if ( {{ player.belief_subpage }} == 1) {
    var btn = document.getElementById("myBtn1");
} else if ( {{ player.belief_subpage }} == 2) {
    var btn = document.getElementById("myBtn2");
}

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal and stop all videos
span.onclick = function() {
  let simple_instruction= js_vars.simple_instruction;
  if (simple_instruction === false) {
      video1.pause();
      video2.pause();
      video3.pause();
  }
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>
<!-- Load video controls -->
<script>
window.onload = function() {
    // Video
    var video1 = document.getElementById("myVideo1");
    var video2 = document.getElementById("myVideo2");
    var video3 = document.getElementById("myVideo3");

    // Buttons
    var playButton1 = document.getElementById("play-pause1");
    var playButton2 = document.getElementById("play-pause2");
    var playButton3 = document.getElementById("play-pause3");
    var muteButton1 = document.getElementById("mute1");
    var muteButton2 = document.getElementById("mute2");
    var muteButton3 = document.getElementById("mute3");

    // Sliders
    var seekBar1 = document.getElementById("seek-bar1");
    var seekBar2 = document.getElementById("seek-bar2");
    var seekBar3 = document.getElementById("seek-bar3");
    var volumeBar1 = document.getElementById("volume-bar1");
    var volumeBar2 = document.getElementById("volume-bar2");
    var volumeBar3 = document.getElementById("volume-bar3");

    // Event listener for the play/pause button
    // Video 1
    playButton1.addEventListener("click", function() {
        if (video1.paused == true) {
            // Play the video and pause all others
            video1.play();
            video2.pause();
            video3.pause();

            // Update the button text to 'Pause' and all others to 'Play'
            playButton1.innerHTML = "Pause";
            playButton2.innerHTML = "Play";
            playButton3.innerHTML = "Play";
        } else {
            // Pause the video
            video1.pause();

            // Update the button text to 'Play'
            playButton1.innerHTML = "Play";
        }
    });
    // Video 2
    playButton2.addEventListener("click", function() {
        if (video2.paused == true) {
            // Play the video and pause all others
            video1.pause();
            video2.play();
            video3.pause();

            // Update the button text to 'Pause' and all others to 'Play'
            playButton1.innerHTML = "Play";
            playButton2.innerHTML = "Pause";
            playButton3.innerHTML = "Play";
        } else {
            // Pause the video
            video2.pause();

            // Update the button text to 'Play'
            playButton2.innerHTML = "Play";
        }
    });
    // Video 3
    playButton3.addEventListener("click", function() {
        if (video3.paused == true) {
            // Play the video and pause all others
            video1.pause();
            video2.pause();
            video3.play();

            // Update the button text to 'Pause' and all others to 'Play'
            playButton1.innerHTML = "Play";
            playButton2.innerHTML = "Play";
            playButton3.innerHTML = "Pause";
        } else {
            // Pause the video
            video3.pause();

            // Update the button text to 'Play'
            playButton3.innerHTML = "Play";
        }
    });

    // Event listener for the mute button
    // Video 1
    muteButton1.addEventListener("click", function() {
        if (video1.muted == false) {
            // Mute the video
            video1.muted = true;

            // Update the button text
            muteButton1.innerHTML = "Unmute";
        } else {
            // Unmute the video
            video1.muted = false;

            // Update the button text
            muteButton1.innerHTML = "Mute";
        }
    });
    // Video 2
    muteButton2.addEventListener("click", function() {
        if (video2.muted == false) {
            // Mute the video
            video2.muted = true;

            // Update the button text
            muteButton2.innerHTML = "Unmute";
        } else {
            // Unmute the video
            video2.muted = false;

            // Update the button text
            muteButton2.innerHTML = "Mute";
        }
    });
    // Video 3
    muteButton3.addEventListener("click", function() {
        if (video3.muted == false) {
            // Mute the video
            video3.muted = true;

            // Update the button text
            muteButton3.innerHTML = "Unmute";
        } else {
            // Unmute the video
            video3.muted = false;

            // Update the button text
            muteButton3.innerHTML = "Mute";
        }
    });

    // Event listener for the seek bar
    // Video 1
    seekBar1.addEventListener("change", function() {
        // Calculate the new time
        var time1 = video1.duration * (seekBar1.value / 100);

        // Update the video time
        video1.currentTime = time1;
    });
    // Video 2
    seekBar2.addEventListener("change", function() {
        // Calculate the new time
        var time2 = video2.duration * (seekBar2.value / 100);

        // Update the video time
        video2.currentTime = time2;
    });
    // Video 3
    seekBar3.addEventListener("change", function() {
        // Calculate the new time
        var time3 = video3.duration * (seekBar3.value / 100);

        // Update the video time
        video3.currentTime = time3;
    });

    // Update the seek bar as the video plays
    // Video 1
    video1.addEventListener("timeupdate", function() {
        // Calculate the slider value
        var value1 = (100 / video1.duration) * video1.currentTime;

        // Update the slider value
        seekBar1.value = value1;
    });
    // Video 2
    video2.addEventListener("timeupdate", function() {
        // Calculate the slider value
        var value2 = (100 / video2.duration) * video2.currentTime;

        // Update the slider value
        seekBar2.value = value2;
    });
    // Video 3
    video3.addEventListener("timeupdate", function() {
        // Calculate the slider value
        var value3 = (100 / video3.duration) * video3.currentTime;

        // Update the slider value
        seekBar3.value = value3;
    });

    // Pause the video when the slider handle is being dragged
    // Video 1
    seekBar1.addEventListener("mousedown", function() {
        video1.pause();
        playButton1.innerHTML = "Play";
        video2.pause();
        playButton2.innerHTML = "Play";
        video3.pause();
        playButton2.innerHTML = "Play";
    });
    // Video 2
    seekBar2.addEventListener("mousedown", function() {
        video1.pause();
        playButton1.innerHTML = "Play";
        video2.pause();
        playButton2.innerHTML = "Play";
        video3.pause();
        playButton2.innerHTML = "Play";
    });
    // Video 3
    seekBar3.addEventListener("mousedown", function() {
        video1.pause();
        playButton1.innerHTML = "Play";
        video2.pause();
        playButton2.innerHTML = "Play";
        video3.pause();
        playButton2.innerHTML = "Play";
    });

    // Play the video when the slider handle is dropped
    // Video 1
    seekBar1.addEventListener("mouseup", function() {
        video1.play();
        playButton1.innerHTML = "Pause";
    });
    // Video 2
    seekBar2.addEventListener("mouseup", function() {
        video2.play();
        playButton2.innerHTML = "Pause";
    });
    // Video 3
    seekBar3.addEventListener("mouseup", function() {
        video3.play();
        playButton3.innerHTML = "Pause";
    });

    // Event listener for the volume bar
    // Video 1
    volumeBar1.addEventListener("change", function() {
        // Update the video volume
        video1.volume = volumeBar1.value;
    });
    // Video 2
    volumeBar2.addEventListener("change", function() {
        // Update the video volume
        video2.volume = volumeBar2.value;
    });
    // Video 3
    volumeBar3.addEventListener("change", function() {
        // Update the video volume
        video3.volume = volumeBar3.value;
    });
}
</script>
{{ endblock }}

{{ block styles }}
{% if player.belief_subpage == 1 %}
<link href="{{ static 'belief-slider-1.css' }}" rel="stylesheet">
{% elif player.belief_subpage == 2 %}
<link href="{{ static 'belief-slider-2.css' }}" rel="stylesheet">
{% endif %}
<style>
    .tab {
        display: none;
        text-align: justify;
    }
    .otree-title {
        text-align: center;
    }
    .otree-body{
        font-size: 103%;
    }
    .otree-timer {
        display: none;
    }
</style>
<style>
    #active1 {
        display: none;
    }
    #inactive1 {
        display: block;
    }
</style>
<style>
    #instruction2 {
        display: block;
    }
    #certain2 {
        display: none;
    }
    #uncertain2 {
        display: none;
    }
    #active2 {
        display: none;
    }
    #inactive2 {
        display: block;
    }
</style>
<style>
.urn{
background: linear-gradient(44deg, #a4f2ff, #c8f7ff);
width: 262px;
height: 304px;
border: 6px solid rgb(56, 56, 56);
border-bottom-left-radius: 15%;
border-bottom-right-radius: 15%;
margin: auto;
border-top: none;
position: relative;
box-shadow: 11px 11px 12px 2px rgb(0 0 0 / 5%);
}
.urn-10{
    width:130px;
    height:260px;
}
.ball{
position: absolute;
width: 20px;
height: 20px;
border-radius: 50%;
border: 1px solid #7e7e7e;
box-shadow:inset 3px -4px 8px rgba(255, 255, 255, 0.384), inset -3px 1px 4px rgba(0, 0, 0, 0.404), 0 0 1px #0000003b ;
transition: border 0.5s ease;
}

.urn-10 .ball{
    width: 45px;
    height: 45px;
}

.ball:nth-child(4n){
z-index: 100;
}

.ball:nth-child(2n){
z-index: 50;
}


.ball.highlighted{
border: 3px solid yellow;
z-index: 100;
}

.ball.highlightedAll{
border: 2px solid yellow;
}

.ball.uncolored{
border-color: #7e7e7e;
}

.ball.uncolored:before{
    content: '?';
    width:100%;
    height:100%;
    font-size:13px;
    display:flex;
    align-items:center;
    justify-content:center;
}

.left-column{
position: relative;
left: -260px;
height: 100%;
bottom: 0;
text-align: right;
}

.urn-10 .left-column{
    left:-140px;
}

.color-row{
position: absolute;
width: 100%;
transition: all 0.5s ease;
}

.color-row.highlighted,
.color-row.highlightedAll{
    color: rgb(242 215 36);
    transform: translateX(-15px) scale(1.1);
}
</style>
<style>
a:link {
  color: black;
  background-color: transparent;
  text-decoration: underline;
}

a:visited {
  color: black;
  background-color: transparent;
  text-decoration: underline;
}

a:hover {
  color: black;
  background-color: transparent;
  text-decoration: underline;
}

a:active {
  color: black;
  background-color: transparent;
  text-decoration: underline;
}
</style>
<style>
.slider::-webkit-slider-thumb{
    transition: opacity 0.5s ease;
}

.slider-thumb-hidden::-webkit-slider-thumb{
    opacity: 0;
}
</style>
<!-- Overlay instructions -->
<style>
/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 75%; /* Full width */
  height: 75%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  position: relative;
  background-color: White;
  margin: auto;
  padding: 0;
  border: 1px solid #888;
  width: 80%;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
  -webkit-animation-name: animatetop;
  -webkit-animation-duration: 0.4s;
  animation-name: animatetop;
  animation-duration: 0.4s
}

/* Add Animation */
@-webkit-keyframes animatetop {
  from {top:-300px; opacity:0}
  to {top:0; opacity:1}
}

@keyframes animatetop {
  from {top:-300px; opacity:0}
  to {top:0; opacity:1}
}

/* The Close Button */
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.modal-dialog{
  overflow-y: initial;
}

.modal-header {
  padding: 0px 0px;
  background-color: lightgray;
  color: white;
}

.modal-body {
  padding: 2px 16px;
  height: 80vh;
  overflow-y: auto;
}

.modal-footer {
  padding: 2px 16px;
  background-color: lightgray;
  color: white;
}
</style>
<!-- Hide video controls-->
<style>
video {
  pointer-events: none;
}
</style>
{{ endblock }}

{{ block content }}

{% if player.belief_subpage == 1 %}

<p>
    {% if treatambiguity %}
    In this round, the urn consists of <b>{{ session.config.numballs }} balls of up to {% if prior == 50 %}2{% else %}5{% endif %} different colors</b>.
    <br>
    Specifically, there may be some balls that are {% if prior == 50 %}{{ slicecolor1 }}, and some that are {{ slicecolor2 }}{% else %}{{ slicecolor1 }}, {{ slicecolor2 }}, {{ slicecolor3 }}, {{ slicecolor4 }}, and {{ slicecolor5 }}{% endif %} in color.
    <br>
    There are no other colors apart from these {% if prior == 50 %}two{% else %}five{% endif %}.
    <br>
    You do <b>not</b> know the exact composition of the urn.
    {% elif treatrisk %}
    In this round, the urn consists of <b>{{ session.config.numballs }} balls</b>, with composition as shown in the figure below.
<!--    <br>-->
<!--    Specifically, there are {% if prior == 50 %}<b>{{ numcolor1 }}</b> {{ slicecolor1 }} and <b>{{ numcolor2 }}</b> {{ slicecolor2 }} balls{% else %}<b>{{ numcolor1 }}</b> {{ slicecolor1 }} balls, <b>{{ numcolor2 }}</b> {{ slicecolor2 }} balls, <b>{{ numcolor3 }}</b> {{ slicecolor3 }} balls, <b>{{ numcolor4 }}</b> {{ slicecolor4 }} balls, and <b>{{ numcolor5 }}</b> {{ slicecolor5 }} balls{% endif %}.-->
    {% endif %}
    <br><br>
</p>

<div class="urn">
    <div class="left-column">
        <div class="color-row row-1"></div>
        <div class="color-row row-2"></div>
        <div class="color-row row-3"></div>
        <div class="color-row row-4"></div>
        <div class="color-row row-5"></div>
        <div class="color-row row-6"></div>
        <div class="color-row row-7"></div>
        <div class="color-row row-8"></div>
        <div class="color-row row-9"></div>
        <div class="color-row row-10"></div>
    </div>
</div>

<br><br>

<p>
    <u><b><font color="#cc0000">PREDICTED EVENT:</font></b></u> The randomly drawn ball <a href='#' class="predicted-event"><b>is
    {% if predicttrue %}<b>{{ colorevent }}</b>.{% endif %}
    {% if predictfalse %}<b>either
        {% if slicecolor1 != colorevent %}{{ slicecolor1 }}, {% endif %}
        {% if slicecolor2 != colorevent %}{{ slicecolor2 }}, {% endif %}
        {% if slicecolor3 != colorevent %}{{ slicecolor3 }}, {% endif %}
        {% if slicecolor4 != colorevent %}
            {% if slicecolor5 == colorevent %}or {{ slicecolor4 }}.{% endif %}
            {% if slicecolor5 != colorevent %}{{ slicecolor4 }}, {% endif %}
        {% endif %}
        {% if slicecolor5 != colorevent %}or {{ slicecolor5 }}.{% endif %}</b>
    {% endif %}</b></a>
    <br>
    <br>
    What is your prediction (out of 100) that a randomly drawn ball is
    {% if predicttrue %}{{ colorevent }}?{% endif %}
    {% if predictfalse %}either
        {% if slicecolor1 != colorevent %}{{ slicecolor1 }}, {% endif %}
        {% if slicecolor2 != colorevent %}{{ slicecolor2 }}, {% endif %}
        {% if slicecolor3 != colorevent %}{{ slicecolor3 }}, {% endif %}
        {% if slicecolor4 != colorevent %}
            {% if slicecolor5 == colorevent %}or {{ slicecolor4 }}?{% endif %}
            {% if slicecolor5 != colorevent %}{{ slicecolor4 }}, {% endif %}
        {% endif %}
        {% if slicecolor5 != colorevent %}or {{ slicecolor5 }}?{% endif %}
    {% endif %}
    <br>
    <br>
</p>

<div align="center">
    <label for="demo1" class="float-left" style="width:300px" align="left">
        <b>
            You predict a <span id="demo1"></span>% chance that ball is <br>
            {% if predicttrue %}
                {% if prior != 50 %}
                    {% if slicecolor1 != colorevent %}{{ slicecolor1 }}, {% endif %}
                    {% if slicecolor2 != colorevent %}{{ slicecolor2 }}, {% endif %}
                    {% if slicecolor3 != colorevent %}{{ slicecolor3 }}, {% endif %}
                    {% if slicecolor4 != colorevent %}
                        {% if slicecolor5 == colorevent %}or {{ slicecolor4 }}.{% endif %}
                        {% if slicecolor5 != colorevent %}{{ slicecolor4 }}, {% endif %}
                    {% endif %}
                    {% if slicecolor5 != colorevent %}or {{ slicecolor5 }}.{% endif %}
                {% elif prior == 50 %}
                    {% if slicecolor1 != colorevent %}{{ slicecolor1 }}{% elif slicecolor2 != colorevent %}{{ slicecolor2 }}{% endif %}.
                {% endif %}
            {% else %}
            {{ colorevent }}.
            {% endif %}
        </b>
    </label>
    <label for="demo2" class="float-right" style="width:300px" align="right">
        <b>
            You predict a <span id="demo2"></span>% chance that ball is <br>
            {% if predictfalse %}
                {% if prior != 50 %}
                    {% if slicecolor1 != colorevent %}{{ slicecolor1 }}, {% endif %}
                    {% if slicecolor2 != colorevent %}{{ slicecolor2 }}, {% endif %}
                    {% if slicecolor3 != colorevent %}{{ slicecolor3 }}, {% endif %}
                    {% if slicecolor4 != colorevent %}
                        {% if slicecolor5 == colorevent %}or {{ slicecolor4 }}.{% endif %}
                        {% if slicecolor5 != colorevent %}{{ slicecolor4 }}, {% endif %}
                    {% endif %}
                    {% if slicecolor5 != colorevent %}or {{ slicecolor5 }}.{% endif %}
                {% elif prior == 50 %}
                    {% if slicecolor1 != colorevent %}{{ slicecolor1 }}{% elif slicecolor2 != colorevent %}{{ slicecolor2 }}{% endif %}.
                {% endif %}
            {% else %}
            {{ colorevent }}.
            {% endif %}
        </b>
    </label>

    <div class="slidecontainer">
        <input type="range" min="0" max="100" step="1" value="-1" class="slider slider-thumb-hidden" id="myRange1" name="belief">
    </div>
    <br>
</div>


<p style="align: left">
    <font size="+1"><b>Reminder: {% if bsr %}Your chance of receiving &euro;{{ stakes|to2 }} will depend <i>both</i> on your prediction and which ball is drawn from this urn, according to the <font color="maroon">payment procedure</font>.{% else %}Your payoff will depend <i>both</i> on your prediction and which ball is drawn from this urn, according to the <font color="maroon">payment procedure</font>.{% endif %}</b></font>
    <br>
    Click this link to see the instructions again (you will remain on this page): <button id="myBtn1" type="button" class="btn btn-link mb-3">Review Payment Procedure</button>
</p>

<br>
<br>

<div class="button" align="center" id="active1">
    <button class="btn btn-danger mb-3">
        SUBMIT
    </button>
</div>

<div class="button" align="center" id="inactive1">
    <button class="btn btn-secondary disabled mb-3">
        SUBMIT
    </button>
</div>

{% elif player.belief_subpage == 2 %}

<!--<p>-->
<!--    In the previous screen, you stated that there is a <font size="+2"><b>{{ player.belief }}% chance</b></font> that a randomly drawn ball is-->
<!--    {% if predicttrue %}{{ colorevent }}.{% endif %}-->
<!--    {% if predictfalse %}either-->
<!--        {% if slicecolor1 != colorevent %}{{ slicecolor1 }}, {% endif %}-->
<!--        {% if slicecolor2 != colorevent %}{{ slicecolor2 }}, {% endif %}-->
<!--        {% if slicecolor3 != colorevent %}{{ slicecolor3 }}, {% endif %}-->
<!--        {% if slicecolor4 != colorevent %}-->
<!--            {% if slicecolor5 == colorevent %}or {{ slicecolor4 }}.{% endif %}-->
<!--            {% if slicecolor5 != colorevent %}{{ slicecolor4 }}, {% endif %}-->
<!--        {% endif %}-->
<!--        {% if slicecolor5 != colorevent %}or {{ slicecolor5 }}.{% endif %}-->
<!--    {% endif %}-->
<!--    <br><br>-->
<!--    <b>Remember that {% if bsr %}your chance of receiving &euro;{{ stakes }} depends on the accuracy of your prediction.{% else %}your payoff depends on the accuracy of your prediction.{% endif %}</b>-->
<!--    <br><br>-->
<!--    Given the payment mechanism, how <b><font color="0000cc">certain</font></b> are you that {{ player.belief }}% is the <b>optimal answer</b> to give?-->
<!--</p>-->

<p align="center">
    <br><br>
    Your prediction was <font size="+2"><b>{{ player.belief }}%</b></font>.
</p>

<!--<p>-->
<!--    <br><br>-->
<!--    Given the <font color="maroon"><b>payment procedure</b></font>, how <b><font color="0000cc">certain</font></b> are you that {{ player.belief }}% is the <b>optimal answer</b> to give?-->
<!--</p>-->

<p>
    <br><br>
    Given the <font color="maroon"><b>payment procedure</b></font>, how <b><font color="0000cc">certain</font></b> are you that the <b>optimal answer</b> is between {{ minvalue }}% and {{ maxvalue }}%?
</p>

<br>

<center>
    <table style="width:100%">

        <tr>
            {{ for choice in form.cognitive_certainty }}
            <td style="width:4.5%; padding-left:18px; text-align:center">{{ choice }}<br></td>
            {{ endfor }}
        </tr>
        <tr>
            {{ for choice in form.cognitive_certainty }}
            <td style="width:4.5%; padding-left:0px; text-align:center">{{ choice.label }}</td>
            {{ endfor }}
        </tr>
        <tr>
            <td colspan="10" style="text-align:left; padding-left:0px"><b>Very uncertain</b></td>
            <td colspan="11" style="text-align:right; padding-right:0px"><b>Completely certain</b></td>
        </tr>
    </table>
</center>

<div class="button" align="right">
    <br><br>
    <button class="btn btn-primary mb-3">
        NEXT
    </button>
</div>

<!--<center>-->
<!--    <label for="myRange2" class="float-left" style="width:300px" align="left"><b><font color="#0000cc">Very uncertain</font></b></label>-->
<!--    <label for="myRange2" class="float-right" style="width:300px" align="right"><b><font color="#0000cc">Completely certain</font></b></label>-->
<!--    <div class="slidecontainer2">-->
<!--        <input type="range" min="{{ uncertaintymin }}" max="100" step="1" value="-1" class="slider slider-thumb-hidden" id="myRange2" name="cognitive_certainty">-->
<!--    </div>-->
<!--</center>-->
<!--<br>-->

<!--<div id="instruction2">-->
<!--    Please adjust the slider.-->
<!--</div>-->
<!--<div id="certain2">-->
<!--    I am certain that the optimal prediction is <b>exactly {{ player.belief }}%</b>.-->
<!--</div>-->
<!--<div id="uncertain2">-->
<!--    I am certain that the optimal prediction is <b>between <span id="min"></span>% and <span id="max"></span>%</b>.-->
<!--</div>-->

<!--<div class="button" align="right" id="active2">-->
<!--    <br><br>-->
<!--    <button class="btn btn-primary mb-3">-->
<!--        NEXT-->
<!--    </button>-->
<!--</div>-->

<!--<div class="button" align="right" id="inactive2">-->
<!--    <br><br>-->
<!--    <button class="btn btn-secondary disabled mb-3">-->
<!--        NEXT-->
<!--    </button>-->
<!--</div>-->

{% endif %}

<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <center><font size="+2">
              <b>Instructions</b>
            </font></center>
            <p>
            <br>
            {% if session.config.prolific %}This experiment {% else %}Part A {% endif %}consists of six rounds of an individual decision-making task. At the end of the experiment,{% if session.config.prolific == False %} if you are paid for Part A, then{% endif %} the computer will randomly pick <b>one of the six rounds</b> for payment.
    <br><br>
    In each round, your task is to predict the chances that an "event" will occur.
    <br><br>
    For example: What is the chance that a random card drawn from a full deck of standard playing cards is a heart?
    <br>
    We want you to predict this chance from 0 to 100%.
    <br><br>
    {{ if bsr }}
    <b>You will want to think about your answer carefully. This is because, based on the prediction you give, we will use a <font color="maroon">payment procedure</font> that rewards you with up to 100 lottery tickets to earn a prize of {{ if stakeshigh }}{{ stakes }}{{ else }}{{ stakes|to2 }}{{ endif }} euros.</b>
    <br><br>
    <b>Each lottery ticket corresponds to a 1% chance to win the prize of {{ if stakeshigh }}{{ stakes }}{{ else }}{{ stakes|to2 }}{{ endif }} euros.</b> So, the more lottery tickets you have, the higher your chances will be to win.
    {{ elif qsr }}
    <b>You will want to think about your answer carefully. This is because, based on the prediction you give, we will use a <font color="maroon">payment procedure</font> that rewards you with up to 100 tickets worth up to a combined maximum value of {{ if stakeshigh }}{{ stakes }}{{ else }}{{ stakes|to2 }}{{ endif }} euros.</b>
    <br><br>
    <b>Each ticket is worth {{ if stakeshigh }}<script>document.write({{ stakes }}/100*100)</script> cents{{ else }}<script>document.write({{ stakes }}/100*100)</script> cents{{ endif }}.</b> So, the more tickets you have, the more money you will receive.
    {{ endif }}
    <br><br>
    The number of {{ if bsr }}lottery {{ endif}}tickets you will receive is determined by the following formulas:
    <br><br>
    &emsp;&emsp; Number of {{ if bsr }}lottery {{ endif}}tickets if <i>Event</i> <b>occurs</b> = \(\left[1-\left(\frac{100-\text{your prediction}}{100}\right)^2\right]\times 100\)
    <br>
    &emsp;&emsp; Number of {{ if bsr }}lottery {{ endif}}tickets if <i>Event</i> <b>does not occur</b> = \(\left[1-\left(\frac{\text{your prediction}}{100}\right)^2\right]\times 100\)
    <br><br>
    <b>In summary, you will receive more {{ if bsr }}lottery {{ endif}}tickets on average if your prediction of the <i>Event</i> is more accurate.</b>
            </p>
            {% if session.config.simple_instruction == False %}
            <center><font size="+2">
               <b>Instructions (Video 1)</b>
            </font>
                <br>
                Watch Part 1 of the video below.
                <br>
                <video width="800" height="500" id="myVideo1">
                   <source src="{{ static video1path }}" type="video/mp4">
                   Video not supported. Please use a supported browser, or send a message to the Experimenter.
                </video>
                <!-- Video 1 Controls -->
                <div id="video-controls1">
                <button type="button" id="play-pause1">Play/Pause</button>
                <input type="range" id="seek-bar1" value="0">
                <button type="button" id="mute1">Mute</button>
                <input type="range" id="volume-bar1" min="0" max="1" step="0.1" value="1">
                </div>
            </center>
            <center><font size="+2">
               <b>Instructions (Video 2)</b>
            </font>
                <br>
                Watch Part 2 of the video below.
                <br>
                <video width="800" height="500" id="myVideo2">
                   <source src="{{ static video2path }}" type="video/mp4">
                   Video not supported. Please use a supported browser, or send a message to the Experimenter.
                </video>
                <!-- Video 2 Controls -->
                <div id="video-controls2">
                <button type="button" id="play-pause2">Play/Pause</button>
                <input type="range" id="seek-bar2" value="0">
                <button type="button" id="mute2">Mute</button>
                <input type="range" id="volume-bar2" min="0" max="1" step="0.1" value="1">
                </div>
            </center>
            <center><font size="+2">
               <b>Instructions (Video 3)</b>
            </font>
                <br>
                Watch Part 3 of the video below.
                <br>
                <video width="800" height="500" id="myVideo3">
                   <source src="{{ static video3path }}" type="video/mp4">
                   Video not supported. Please use a supported browser, or send a message to the Experimenter.
                </video>
                <!-- Video 3 Controls -->
                <div id="video-controls3">
                <button type="button" id="play-pause3">Play/Pause</button>
                <input type="range" id="seek-bar3" value="0">
                <button type="button" id="mute3">Mute</button>
                <input type="range" id="volume-bar3" min="0" max="1" step="0.1" value="1">
                </div>
            </center>
            {% endif %}
        </div>
        <div class="modal-footer"></div>
    </div>
</div>

{{ endblock }}
